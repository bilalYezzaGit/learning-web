/**
 * Print booklet styles — professional identity for printed livrets.
 *
 * Provides @media print rules for A4 page setup, running headers/footers,
 * page break control, and screen preview styles.
 */

/* ─── Screen: toolbar spacing ─── */
@media screen {
  .print-booklet {
    padding-top: 4rem;
    background: #f5f3f0;
    min-height: 100svh;
  }
}

/* ─── Print: page setup ─── */
@media print {
  @page {
    size: A4;
    margin: 20mm 16mm 22mm 16mm;
  }

  @page :first {
    margin: 0;
  }

  /* ── Global reset ── */
  .print-booklet {
    padding-top: 0 !important;
    background: white !important;
    color: #1c1917 !important;
    font-size: 10.5pt !important;
  }

  /* ── Cover page ── */
  .print-cover {
    page-break-after: always;
    break-after: page;
    min-height: 100vh;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* ── Hide screen-only elements ── */
  .print-no-print,
  .print-toolbar,
  .print\:hidden {
    display: none !important;
  }

  /* ── Section headers: never orphaned ── */
  .print-section-header {
    page-break-after: avoid;
    break-after: avoid;
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* ── Exercise frame: AVOID page cut ── */
  .print-exercise-frame {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* If the exercise writing area is very long, allow break ONLY inside lines */
  .print-writing-area {
    page-break-inside: auto;
    break-inside: auto;
  }

  /* ── QCM frame: keep together ── */
  .print-qcm-frame {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* ── Lesson: allow break but not inside blocks ── */
  .print-lesson-frame {
    page-break-inside: auto;
    break-inside: auto;
  }

  .print-lesson-frame aside {
    page-break-inside: avoid;
    break-inside: avoid;
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }

  /* ── KaTeX math blocks ── */
  .print-booklet .katex-display {
    border: 1px solid #d6d3d1 !important;
    background: #fafaf9 !important;
    box-shadow: none !important;
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* ── Hide collapsible details (solutions) ── */
  .print-booklet details {
    display: none !important;
  }

  /* ── Footer page ── */
  .print-booklet-footer {
    page-break-before: always;
    break-before: page;
  }

  /* ── Prose in print ── */
  .print-booklet .prose {
    max-width: 100% !important;
    font-size: 10.5pt !important;
    line-height: 1.65 !important;
  }

  .print-booklet .prose h3 {
    font-size: 11.5pt !important;
    margin-top: 0.8em !important;
    margin-bottom: 0.4em !important;
  }

  /* Links: don't show URL */
  .print-booklet .prose a::after {
    content: none !important;
  }

  /* Tables: clean for print */
  .print-booklet .prose table {
    box-shadow: none !important;
    font-size: 9.5pt !important;
  }

  /* ── Color preservation ── */
  .print-booklet aside,
  .print-booklet [data-print-color],
  .print-booklet .print-qr-badge,
  .print-booklet .print-cover-bg,
  .print-booklet .print-exercise-header,
  .print-booklet .print-qcm-header,
  .print-booklet .print-lesson-accent {
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }

  /* ── Graphs: bordered container ── */
  .print-booklet .prose svg,
  .print-booklet .recharts-wrapper {
    page-break-inside: avoid;
    break-inside: avoid;
    border: 1px solid #d6d3d1;
    border-radius: 6px;
    padding: 8px;
  }

  /* ── Page running header ── */
  .print-running-header {
    position: running(header);
  }

  /* ── Page running footer ── */
  .print-running-footer {
    position: running(footer);
  }
}

/* ─── Screen: preview styles ─── */
@media screen {
  .print-page-content {
    max-width: 52rem;
    margin: 0 auto;
    padding: 0 1.5rem 3rem;
  }

  .print-cover {
    border-bottom: 2px dashed #d6d3d1;
    margin-bottom: 2rem;
  }

  .print-booklet-footer {
    border-top: 2px dashed #d6d3d1;
    margin-top: 2rem;
  }
}
